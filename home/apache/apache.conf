<VirtualHost *:80>
    ServerName ops.${OPS_DOMAIN}
    DocumentRoot /var/www/dashboard/public

    <Directory "/var/www/dashboard">
        Require all granted
        AllowOverride All
        Options FollowSymLinks
    </Directory>
</VirtualHost>

<VirtualHost *:80>
    ServerAlias *

    LogLevel debug rewrite:trace6
    #LogLevel info

    # ErrorDocument 403 /var/www/dashboard/forbidden.php
    # ErrorDocument 403 /var/www/html/ops-home/public/forbidden.html

    RewriteEngine on

    #RewriteCond %{HTTP_HOST} "^([a-z][a-z0-9-]+)-www\.${OPS_DOMAIN}$" [NC] [OR]
    RewriteCond %{HTTP_HOST} "^([a-z][a-z0-9-]+)\.${OPS_DOMAIN}(:[0-9]+)?$" [NC]
    RewriteRule .* - [E=OPS_SITE_NAME:%1]

    # RewriteMap docroot "txt:/var/www/html/ops-docroot"

    RewriteCond %{ENV:OPS_SITE_NAME} ^$
    RewriteRule ^.*$ - [F]

    RewriteCond /var/www/html/%{ENV:OPS_SITE_NAME}/public -d
    RewriteRule ^(.*) /var/www/html/%{ENV:OPS_SITE_NAME}/public/$1 [QSA,L,E=OPS_DOCUMENT_ROOT:/var/www/html/%{ENV:OPS_SITE_NAME}/public]

    RewriteCond /var/www/html/%{ENV:OPS_SITE_NAME}/web -d
    RewriteRule ^(.*) /var/www/html/%{ENV:OPS_SITE_NAME}/web/$1 [QSA,L,E=OPS_DOCUMENT_ROOT:/var/www/html/${ENV:OPS_SITE_NAME}/web]

    RewriteCond /var/www/html/%{ENV:OPS_SITE_NAME}/htdocs -d
    RewriteRule ^(.*) /var/www/html/%{ENV:OPS_SITE_NAME}/htdocs/$1 [QSA,L,E=OPS_DOCUMENT_ROOT:/var/www/html/%{ENV:OPS_SITE_NAME}/htdocs]

    RewriteCond /var/www/html/%{ENV:OPS_SITE_NAME}/public_html -d
    RewriteRule ^(.*) /var/www/html/%{ENV:OPS_SITE_NAME}/htdocs/$1 [QSA,L,E=OPS_DOCUMENT_ROOT:/var/www/html/%{ENV:OPS_SITE_NAME}/public_html]

    RewriteCond /var/www/html/%{ENV:OPS_SITE_NAME}/docroot -d
    RewriteRule ^(.*) /var/www/html/%{ENV:OPS_SITE_NAME}/docroot/$1 [QSA,L,E=OPS_DOCUMENT_ROOT:/var/www/html/%{ENV:OPS_SITE_NAME}/docroot]

    RewriteCond /var/www/html/%{ENV:OPS_SITE_NAME} -d
    RewriteRule ^(.*) /var/www/html/%{ENV:OPS_SITE_NAME}/$1 [QSA,L,E=OPS_DOCUMENT_ROOT:/var/www/html/%{ENV:OPS_SITE_NAME}]

    RewriteCond %{ENV:OPS_DOCUMENT_ROOT} ^$
    RewriteRule ^.*$ - [F]


    # Add default charset

    AddDefaultCharset utf-8
</VirtualHost>
